# Configuration for medical image preprocessing optimised for X-ray pneumonia detection

# Model configuration
model:
  name: "resnet18"
  num_classes: 2  # NORMAL and PNEUMONIA
  freeze_base: true
  pretrained: true

# Data preprocessing configuration
data:
  # Image dimensions
  image_size: [224, 224]
  
  # Medical-specific preprocessing
  use_medical_transforms: true
  
  # Batch processing
  batch_size: 32
  num_workers: 4
  
  # Class information
  class_names: ['NORMAL', 'PNEUMONIA']
  
  # Medical image characteristics
  single_channel_input: true  # X-rays are typically grayscale
  convert_to_3channel: true   # Convert to 3-channel for pretrained models
  
  # Normalisation parameters
  # For medical images (grayscale converted to 3-channel)
  normalisation:
    medical_mode:
      mean: [0.5, 0.5, 0.5]    # Mean for each channel
      std: [0.5, 0.5, 0.5]     # Standard deviation for each channel
    standard_mode:
      mean: [0.485, 0.456, 0.406]  # ImageNet mean
      std: [0.229, 0.229, 0.224]   # ImageNet std

# Data augmentation configuration
augmentation:
  # Training augmentation (applies only to training set)
  train:
    enabled: true
    horizontal_flip:
      probability: 0.5
    rotation:
      degrees: 10
    color_jitter:
      brightness: 0.2
      contrast: 0.2
      saturation: 0.0  # Not applicable for grayscale
      hue: 0.0         # Not applicable for grayscale
    random_affine:
      translate: [0.1, 0.1]  # Horizontal and vertical translation
      scale: [0.9, 1.1]      # Scale range
    random_crop:
      enabled: false
      size: [200, 200]      # Crop size if enabled
    
  # Validation augmentation (no random transformations)
  val:
    enabled: false
    resize_only: true
    
  # Test augmentation (same as validation)
  test:
    enabled: false
    resize_only: true

# Advanced medical preprocessing options
medical_preprocessing:
  # Contrast enhancement
  contrast_enhancement:
    enabled: false
    method: "clahe"  # Options: "clahe", "histogram_equalization"
    clip_limit: 2.0
    tile_grid_size: [8, 8]
  
  # Noise reduction
  noise_reduction:
    enabled: false
    method: "gaussian"
    kernel_size: 3
    sigma: 1.0
  
  # Edge enhancement (optional for medical images)
  edge_enhancement:
    enabled: false
    method: "unsharp_mask"
    strength: 1.0
  
  # Intensity normalisation (alternative to standard normalisation)
  intensity_normalisation:
    method: "minmax"  # Options: "minmax", "zscore", "percentile"
    percentile_range: [1, 99]  # For percentile method

# Dataset configuration
dataset:
  # File extensions to include
  supported_extensions: ['.jpg', '.jpeg', '.png', '.bmp', '.tiff']
  
  # Validation split ratio
  validation_split: 0.2
  
  # Test split ratio (from remaining data after validation split)
  test_split: 0.2
  
  # Shuffle data
  shuffle: true
  
  # Random seed for reproducibility
  seed: 42

# Training configuration
training:
  # Number of epochs
  epochs: 10
  
  # Learning rate
  learning_rate: 0.001
  
  # Optimiser settings
  optimiser:
    type: "adam"
    weight_decay: 1e-4
    betas: [0.9, 0.999]
  
  # Learning rate scheduler
  scheduler:
    enabled: true
    type: "reduce_on_plateau"
    factor: 0.1
    patience: 3
    min_lr: 1e-6
  
  # Loss function
  loss:
    type: "cross_entropy"  # Options: "cross_entropy", "focal_loss", "dice_loss"
    class_weights: null    # Will be calculated automatically if null
    focal_loss:
      alpha: 0.25
      gamma: 2.0
  
  # Device configuration
  device: "auto"  # Options: "auto", "cuda", "cpu"
  
  # Mixed precision training
  mixed_precision: false
  
  # Gradient clipping
  gradient_clip_val: 1.0

# Evaluation configuration
evaluation:
  # Metrics to compute
  metrics:
    - "accuracy"
    - "precision"
    - "recall"
    - "f1_score"
    - "auc"
    - "confusion_matrix"
    - "classification_report"
  
  # Threshold for binary classification
  classification_threshold: 0.5
  
  # Cross-validation settings
  cross_validation:
    enabled: false
    folds: 5
    stratified: true

# Logging and visualisation
logging:
  # Training log file
  log_file: "training.log"
  
  # Tensorboard logging
  tensorboard:
    enabled: true
    log_dir: "logs/tensorboard"
  
  # Model checkpointing
  checkpointing:
    enabled: true
    save_dir: "checkpoints"
    save_best_only: true
    monitor: "val_loss"
    mode: "min"
  
  # Visualisation settings
  visualisation:
    enabled: true
    save_dir: "visualisations"
    plot_format: "png"
    dpi: 300
    figsize: [12, 8]

# Experimental settings
experimental:
  # Use test-time augmentation
  test_time_augmentation: false
  
  # Ensemble multiple models
  ensemble:
    enabled: false
    models: ["resnet18", "resnet50", "densenet121", "efficientnet_b0"]
    voting: "soft"  # Options: "soft", "hard"
  
  # Advanced preprocessing pipeline
  advanced_pipeline:
    enabled: false
    steps:
      - "load_image"
      - "convert_to_grayscale"
      - "apply_clahe"
      - "resize"
      - "normalise"
      - "convert_to_tensor"
